<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZahirAI</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  background:#0b1220;
  color:#fff;
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
}
header{
  background:#020617;
  padding:12px;
  text-align:center;
  font-weight:700;
  font-size:18px;
}
.hidden{display:none}
#app{padding:12px}

.card{
  background:#020617;
  border-radius:14px;
  padding:14px;
}

input,button{
  width:100%;
  padding:14px;
  font-size:16px;
  border:none;
  border-radius:10px;
  outline:none;
}

button{
  background:#22c55e;
  margin-top:8px;
  font-weight:600;
  cursor:pointer;
}

button.red{
  background:#ef4444;
}

#chat{
  height:70vh;
  overflow-y:auto;
  padding:6px;
}

.msg{
  max-width:85%;
  padding:10px 12px;
  margin:8px 0;
  border-radius:12px;
  white-space:pre-wrap;
}

.user{background:#2563eb;margin-left:auto}
.ai{background:#334155}

#inputBar{
  display:flex;
  gap:6px;
  margin-top:8px;
}
#inputBar input{flex:1}
#inputBar button{width:60px}
</style>
</head>

<body>

<header>ZahirAI</header>

<div id="app">

<!-- API KEY EKRANI -->
<div id="keyScreen" class="card">
  <h3>Groq API Key</h3>
  <input id="keyInput" placeholder="gsk_...">
  <button onclick="saveKey()">Kaydet</button>
  <p style="font-size:13px;opacity:.7">
    Key sadece bu cihazda saklanır. GitHub’a gitmez.
  </p>
</div>

<!-- CHAT EKRANI -->
<div id="chatScreen" class="hidden">
  <div class="card">
    <div id="chat"></div>

    <div id="inputBar">
      <input id="textInput" placeholder="ZahirAI'ye yaz...">
      <button onclick="sendMsg()">➤</button>
    </div>

    <button class="red" onclick="resetAll()">Key’i ve Hafızayı Sil</button>
  </div>
</div>

</div>

<script>
/* AYARLAR */
const GROQ_URL = "https://api.groq.com/openai/v1/chat/completions";
const MODEL = "llama3-8b-8192";
const SYSTEM_PROMPT = "Sen ZahirAI’sin. Türkçe konuş, net ve yardımcı ol.";

/* DURUM */
let apiKey = localStorage.getItem("groq_key");
let memory = JSON.parse(localStorage.getItem("zahir_memory") || "[]");

/* ELEMENTLER */
const keyScreen = document.getElementById("keyScreen");
const chatScreen = document.getElementById("chatScreen");
const chatBox = document.getElementById("chat");
const textInput = document.getElementById("textInput");

/* BAŞLAT */
if(apiKey) startChat();

/* KEY KAYDET */
function saveKey(){
  const k = document.getElementById("keyInput").value.trim();
  if(!k) return alert("Key boş olamaz");
  localStorage.setItem("groq_key", k);
  apiKey = k;
  startChat();
}

/* CHAT BAŞLAT */
function startChat(){
  keyScreen.classList.add("hidden");
  chatScreen.classList.remove("hidden");
  renderChat();
}

/* RESET */
function resetAll(){
  localStorage.removeItem("groq_key");
  localStorage.removeItem("zahir_memory");
  location.reload();
}

/* CHAT GÖSTER */
function addMsg(text, who){
  const d = document.createElement("div");
  d.className = "msg " + who;
  d.textContent = text;
  chatBox.appendChild(d);
  chatBox.scrollTop = chatBox.scrollHeight;
}

function renderChat(){
  chatBox.innerHTML = "";
  memory.forEach(m => {
    addMsg(m.content, m.role === "user" ? "user" : "ai");
  });
}

/* MESAJ GÖNDER */
async function sendMsg(){
  const text = textInput.value.trim();
  if(!text) return;
  textInput.value = "";

  addMsg(text,"user");
  memory.push({role:"user",content:text});

  if(memory.length > 20) memory = memory.slice(-20);
  localStorage.setItem("zahir_memory", JSON.stringify(memory));

  try{
    const res = await fetch(GROQ_URL,{
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        "Authorization":"Bearer " + apiKey
      },
      body:JSON.stringify({
        model:MODEL,
        messages:[
          {role:"system",content:SYSTEM_PROMPT},
          ...memory
        ]
      })
    });

    const data = await res.json();
    const reply = data.choices[0].message.content;

    addMsg(reply,"ai");
    memory.push({role:"assistant",content:reply});
    localStorage.setItem("zahir_memory", JSON.stringify(memory));

  }catch(e){
    addMsg("Hata oluştu. Key doğru mu?","ai");
  }
}
</script>

</body>
</html>
